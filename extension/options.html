<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CMS Highlighter - Options</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 14px;
      color: #333;
      background: #f5f5f5;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    h1 { font-size: 22px; margin-bottom: 8px; }
    h2 { font-size: 16px; margin: 20px 0 8px; }
    h3 { font-size: 14px; margin: 16px 0 6px; color: #555; }

    .section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .row { display: flex; gap: 10px; align-items: center; margin-bottom: 8px; flex-wrap: wrap; }
    .row label { min-width: 120px; font-weight: 500; }

    input[type="text"], textarea, select {
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
    }
    input[type="text"] { width: 300px; }
    textarea { width: 100%; min-height: 200px; font-family: monospace; font-size: 12px; resize: vertical; }

    button {
      padding: 6px 14px;
      border: 1px solid #bbb;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
      font-size: 13px;
    }
    button:hover { background: #f0f0f0; }
    button.primary { background: #3498db; color: #fff; border-color: #2980b9; }
    button.primary:hover { background: #2980b9; }
    button.danger { background: #e74c3c; color: #fff; border-color: #c0392b; }
    button.danger:hover { background: #c0392b; }

    .msg {
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 12px;
      display: none;
    }
    .msg.success { display: block; background: #d5f5e3; color: #1e8449; border: 1px solid #82e0aa; }
    .msg.error { display: block; background: #fadbd8; color: #922b21; border: 1px solid #f1948a; }

    .ignore-section textarea { min-height: 250px; }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .new-cat-form {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .new-cat-form input[type="text"] { width: 200px; }

    #importFile { display: none; }

    /* Category editor */
    .cat-editor {
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .cat-header {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
      gap: 10px;
      cursor: pointer;
    }
    .cat-header:hover { background: #f0f0f0; }
    .cat-arrow {
      transition: transform 0.2s;
      font-size: 12px;
      color: #999;
    }
    .cat-arrow.open { transform: rotate(90deg); }
    .cat-header-name { flex: 1; font-weight: 500; }
    .cat-header-count { font-size: 12px; color: #999; }
    .cat-body { display: none; padding: 12px; }
    .cat-body.open { display: block; }

    .word-list {
      width: 100%;
      min-height: 150px;
      font-family: monospace;
      font-size: 12px;
      line-height: 1.5;
      resize: vertical;
    }

    .add-word-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .add-word-row input[type="text"] { flex: 1; min-width: 240px; }

    .color-picker-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .color-picker-row input[type="color"] {
      width: 40px;
      height: 28px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Clients UI */
    .clients-topbar {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .clients-topbar input[type="text"] {
      width: 320px;
    }

    .client-add-box {
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      background: #fbfbfb;
      padding: 12px;
      margin-bottom: 12px;
    }

    .client-add-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: end;
    }

    .client-add-grid .field label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .client-add-grid .field input[type="text"],
    .client-add-grid .field select {
      width: 100%;
    }

    .client-add-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .client-list {
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
      background: #fff;
    }

    .client-list-header {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      background: #f7f7f7;
      border-bottom: 1px solid #eee;
      font-size: 12px;
      color: #666;
    }

    .client-list-body {
      max-height: 420px;
      overflow: auto;
    }

    .client-card {
      border-top: 1px solid #eee;
    }

    .client-card:first-child {
      border-top: none;
    }

    .client-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      cursor: pointer;
      background: #fff;
    }
    .client-header:hover { background: #fafafa; }

    .client-arrow {
      transition: transform 0.2s;
      font-size: 12px;
      color: #999;
      width: 14px;
      text-align: center;
      flex: 0 0 auto;
    }
    .client-arrow.open { transform: rotate(90deg); }

    .client-swatch {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid rgba(0,0,0,0.2);
      flex: 0 0 auto;
    }

    .client-pattern {
      font-weight: 600;
      flex: 1 1 auto;
      min-width: 160px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .client-summary {
      font-size: 12px;
      color: #777;
      flex: 0 0 auto;
      max-width: 360px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .client-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex: 0 0 auto;
    }

    .btn-del {
      padding: 4px 10px;
      border: 1px solid #c0392b;
      background: #e74c3c;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 700;
    }
    .btn-del:hover { background: #c0392b; }

    .client-body {
      display: none;
      padding: 12px;
      background: #fcfcfc;
      border-top: 1px solid #eee;
    }
    .client-body.open { display: block; }

    .client-edit-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .client-edit-grid .field label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .client-edit-grid .field input[type="text"],
    .client-edit-grid .field select {
      width: 100%;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid #ddd;
      background: #f5f5f5;
      color: #555;
      margin-left: 6px;
    }

    .muted {
      color: #888;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>CMS Highlighter - Dictionary Editor</h1>

  <div id="msg" class="msg"></div>

  <!-- Import / Export -->
  <div class="section">
    <h2>Import / Export</h2>
    <div class="toolbar">
      <button id="btnExport">Export Dictionary (JSON)</button>
      <button id="btnImportHT">Import HighlightThis Backup</button>
      <button id="btnImportJSON">Import CMS Highlighter JSON</button>
      <input type="file" id="importFile" accept=".json,*">
    </div>
    <p style="font-size: 12px; color: #777;">
      Import your existing HighlightThis backup file, or a previously exported CMS Highlighter dictionary.
    </p>
  </div>

  <!-- Ignore List -->
  <div class="section ignore-section">
    <h2>Ignore List <span id="ignoreCount" style="font-size:12px; color:#999;"></span></h2>
    <p style="font-size: 12px; color: #777; margin-bottom: 8px;">
      Words here block highlights from all categories. One per line. Wildcards (* ?) work.
    </p>
    <textarea id="ignoreListArea" class="word-list" spellcheck="false"></textarea>
    <div style="margin-top: 8px;">
      <button class="primary" id="btnSaveIgnore">Save Ignore List</button>
    </div>
  </div>

  <!-- Clients -->
  <div class="section">
    <h2>Clients <span id="clientCount" style="font-size:12px; color:#999;"></span></h2>
    <p style="font-size: 12px; color: #777; margin-bottom: 10px;">
      Match against the client name shown in the CMS header. Pattern supports * and ?.
      Review uses the Default setting. Image/Profile/Question can override Default.
      <span class="pill">No highlight</span> uses grey.
    </p>

    <div class="clients-topbar">
      <input type="text" id="clientSearch" placeholder="Search clients (pattern contains...)">
      <span id="clientShowing" class="muted"></span>
    </div>

    <div class="client-add-box">
      <h3 style="margin: 0 0 8px; color: #444;">Add client</h3>
      <div class="client-add-grid">
        <div class="field">
          <label>Pattern</label>
          <input type="text" id="newClientPattern" placeholder="Client pattern (supports * and ?)">
        </div>

        <div class="field">
          <label>Review (Default)</label>
          <select id="newClientReview"></select>
        </div>

        <div class="field">
          <label>Image override</label>
          <select id="newClientImage"></select>
        </div>

        <div class="field">
          <label>Profile override</label>
          <select id="newClientProfile"></select>
        </div>

        <div class="field">
          <label>Question override</label>
          <select id="newClientQuestion"></select>
        </div>

        <div class="field">
          <label>Mentions: Category</label>
          <select id="newClientMentionCategory"></select>
        </div>

        <div class="field" style="grid-column: 1 / -1;">
          <label>Mentions: Aliases (one per line, supports * and ?)</label>
          <textarea id="newClientAliases" class="word-list" spellcheck="false" style="min-height: 90px;"></textarea>
        </div>

        <div class="field" style="grid-column: 1 / -1;">
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="newClientIncludePatternInContent" checked>
            Also treat Client Name as a mention in content
          </label>
        </div>

        <div class="field" style="grid-column: 1 / -1;">
          <label>Note</label>
          <input type="text" id="newClientNote" placeholder="Optional note (not used for matching)">
        </div>
      </div>

      <div class="client-add-actions">
        <button class="primary" id="btnAddClient">Add Client</button>
        <span class="muted">Tip: leave overrides as "-" to inherit Default.</span>
      </div>
    </div>

    <div class="client-list">
      <div class="client-list-header">
        <span style="width:14px;"></span>
        <span style="width:14px;"></span>
        <span style="flex: 1;">Client pattern</span>
        <span style="width: 360px;">Summary</span>
        <span style="width: 90px; text-align:right;">Remove</span>
      </div>
      <div id="clientListBody" class="client-list-body"></div>
    </div>
  </div>

  <!-- Categories -->
  <div class="section">
    <h2>Categories</h2>

    <div class="new-cat-form">
      <input type="text" id="newCatName" placeholder="New category name">
      <input type="color" id="newCatColor" value="#FF9900">
      <button class="primary" id="btnAddCat">Add Category</button>
    </div>

    <div id="catEditors"></div>
  </div>

  <script src="options.js"></script>
</body>
</html>
